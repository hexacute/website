<!DOCTYPE html><html ><head><title data-react-helmet="true">Scaling stories - comment les startups se sont plantées | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" name="description" value="Blog participatif de la communauté dev"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="Putain de code" property="og:title"/><meta data-react-helmet="true" content="Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/scaling-stories-comment-les-startups-se-sont-plantees" rel="canonical"/><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion-rpcss="cv6q29 cqg32g vfl2jy 94ols9 1plrth7 1qdfdal">@-webkit-keyframes animation-cv6q29{0%{opacity:0;-webkit-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-cv6q29{0%{opacity:0;-webkit-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}body{padding:0;margin:0;background-color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}@media (prefers-color-scheme:dark){body{background-color:#222;}}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}html{color:#46515B;font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}@media (prefers-color-scheme:dark){html{color:#ddd;}}a{color:#CC0613;-webkit-text-decoration:underline;text-decoration:underline;}@media (prefers-color-scheme:dark){a{color:#F87098;}}a:hover{-webkit-text-decoration:none;text-decoration:none;}*,*:before,*:after{box-sizing:border-box;}</style><style data-emotion-rpcss="u6xx5u">.rpcss-u6xx5u{background-color:#000;padding:10px;color:#fff;text-align:center;}</style><div class="rpcss-u6xx5u"><style data-emotion-rpcss="fyih5c">.rpcss-fyih5c{font-size:24px;font-weight:700;}</style><div class="rpcss-fyih5c" role="heading">Black Lives Matter</div><div><style data-emotion-rpcss="th8dfi">.rpcss-th8dfi{font-size:20px;color:#8CBEF9;}</style><a class="rpcss-th8dfi" href="https://blacklivesmatters.carrd.co/#">Comment aider</a> • <a class="rpcss-th8dfi" href="https://minnesotafreedomfund.org">Minnesota Freedom Fund</a> • <a class="rpcss-th8dfi" href="https://www.okpal.com/adama-traore/#/">Justice Pour Adama</a></div></div><style data-emotion-rpcss="1s4nnc7">.rpcss-1s4nnc7{background-color:#CC0613;background-image:linear-gradient(135deg,#E51D58 0%,#CC0613 100%);}</style><header class="rpcss-1s4nnc7" style="background-image:linear-gradient(to bottom right, hsl(340, 100%, 35%), hsl(282, 100%, 30%))"><style data-emotion-rpcss="qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion-rpcss="7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion-rpcss="gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion-rpcss="1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion-rpcss="13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion-rpcss="4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion-rpcss="u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion-rpcss="1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255,255,255,0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></header><style data-emotion-rpcss="kcj2v3">.rpcss-kcj2v3{background-color:#F9F6F6;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}@media (prefers-color-scheme:dark){.rpcss-kcj2v3{background-color:#111;}}</style><div class="rpcss-kcj2v3"><style data-emotion-rpcss="ees1g6">.rpcss-ees1g6{-webkit-animation:animation-cv6q29 500ms ease-out 0ms 1 normal none running;animation:animation-cv6q29 500ms ease-out 0ms 1 normal none running;}</style><div class="rpcss-ees1g6"><div class="rpcss-qx7dny"><style data-emotion-rpcss="1qc2bam">.rpcss-1qc2bam{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;margin:0;}</style><h1 class="rpcss-1qc2bam">Scaling stories - comment les startups se sont plantées</h1><style data-emotion-rpcss="4ach9y">.rpcss-4ach9y{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:#46515B;-webkit-text-decoration:none;text-decoration:none;}@media (prefers-color-scheme:dark){.rpcss-4ach9y{color:#ccc;}}</style><a class="rpcss-4ach9y" href="https://github.com/cyppan"><style data-emotion-rpcss="uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="cyppan" src="https://avatars.githubusercontent.com/cyppan?size=64"/><div>cyppan<!-- --> <!-- -->•<!-- --> <time dateTime="Tue, 02 Jun 2020 00:00:00 GMT">2020/06/02</time></div></a><style data-emotion-rpcss="1ow2283">.rpcss-1ow2283{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-1ow2283 h2,.rpcss-1ow2283 h3,.rpcss-1ow2283 h4,.rpcss-1ow2283 h5,.rpcss-1ow2283 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-1ow2283 img{max-width:100%;background-color:rgba(255,255,255,0.75);}.rpcss-1ow2283 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:#FAF3E1;margin:0 0.2em;}@media (prefers-color-scheme:dark){.rpcss-1ow2283 code{background-color:#4F3804;}}.rpcss-1ow2283 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid rgba(0,0,0,0.1);-webkit-overflow-scrolling:touch;}@media (prefers-color-scheme:dark){.rpcss-1ow2283 pre{border:2px solid rgba(255,255,255,0.1);}}.rpcss-1ow2283 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-1ow2283 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid rgba(0,0,0,0.4);font-style:italic;}.rpcss-1ow2283 .hljs-keyword{color:#DA6BB5;}.rpcss-1ow2283 .hljs-constructor{color:#DD792B;}.rpcss-1ow2283 .hljs-identifier{color:#1E9EA7;}.rpcss-1ow2283 .hljs-module-identifier{color:#C84682;}.rpcss-1ow2283 .hljs-string{color:#3BA1C8;}.rpcss-1ow2283 .hljs-comment{color:#aaa;}.rpcss-1ow2283 .hljs-operator{color:#DA6BB5;}.rpcss-1ow2283 .hljs-attribute{color:#4CB877;}.rpcss-1ow2283 table{width:100%;text-align:center;}.rpcss-1ow2283 figure{padding:20px 0;}.rpcss-1ow2283 figcaption{text-align:center;}.rpcss-1ow2283 a{overflow-wrap:break-word;}.rpcss-1ow2283 table thead th{background-color:#E4EBEE;padding:10px 0;}</style><div class="rpcss-1ow2283"><blockquote>
<ul>
<li>&quot;Ca ne fonctionne pas, mes enfants n'arrivent pas à se connecter à votre service !&quot;</li>
<li>&quot;Nous sommes désolé notre équipe technique est mobilisée à 100% sur ce problème c'est une situation exceptionnelle… Nous vous tenons au courant.&quot;</li>
</ul>
</blockquote>
<p>C'est le genre de tweet ou de message LinkedIn qu'on a pu voir se multiplier avec le confinement récent dû au Covid-19. En effet les services web, et en particulier les outils de communication ou les programmes du secteur de l'EdTech (education technology), ont dû faire face à un usage particulièrement intense et soutenu ces derniers temps. Il n'y en a que peu à ma connaissance qui ont été capables de maintenir une qualité de service acceptable (Slack et Zoom ont particulièrement brillé sur ce sujet). Si la plupart ont mis en place des solutions minutes comme des queues de connexion,
d'autres encore ont été forcés de désactiver leur service pour une &quot;maintenance&quot; à durée indéterminée…</p>
<p>Même en étant compréhensifs, face à un service planté, on a vite fait de changer. Après tout, avec le choix plus que fourni de services dont on dispose, pourquoi se priver ? Le problème c'est qu'après la crise, il est fort probable que nous ne reviendrons pas au service qu'on avait pourtant trouvé si cool au premier abord… Aïe, pour une startup c'est beaucoup de clients perdus, peut-être assez pour ne jamais retrouver de la traction. Une mort pénible donc pour un business, victime lui aussi du virus.</p>
<p>Mais 🧐</p>
<ul>
<li><em>Ces entreprises n'auraient-elles pas pu mieux anticiper ?</em></li>
<li><em>N'auraient-elles pas pu avoir une meilleure tech à la base, crise ou pas crise ?</em></li>
<li><em>Et une fois devant le problème, n'auraient-elles pas pu mieux s'adapter et plus rapidement ?</em></li>
</ul>
<h2>le modèle de &quot;scaling maturity&quot;</h2>
<p><img src="/public/images/articles/2020-04-02-scaling-stories-comment-les-startups-se-sont-plantees/scaling-maturity-fr.png" alt="modèle de scaling maturity" /></p>
<p>En premier lieu j'aimerais introduire le concept de <em>scaling maturity</em>. &quot;To scale&quot; c'est l'art d'adapter (automatiquement ou non) sa stack technique afin de répondre à la demande en entrée. Et reconnaissons déjà que Zoom et Slack sont beaucoup plus matures que (par exemple) de jeunes startups de l'EdTech.<br />
Analysons les à l'aide du modèle de <em>scaling maturity</em>.</p>
<ol>
<li><strong>Volume d'usage nominal</strong> : Slack ou Zoom avaient déjà un trafic (très) important, le pic d'activité représente un pourcentage plus petit que pour une startup pour qui c'est peut-être un boost de 100 ou 1000 fois l'activité habituelle.</li>
<li><strong>Maturité du produit</strong> : Ils ont eu le temps de connaître les spécificités de leur usage, les caractéristiques d'accès aux données, les points de fragilité de leur système, …</li>
<li><strong>Compétences techniques</strong> : Ils ont probablement une équipe tech plus grande et plus expérimentée.</li>
</ol>
<p>Pour synthétiser, ils en savent beaucoup sur la façon dont leur produit est utilisé et quelle est leur roadmap, et donc savent bien quel type d'effort concentrer pour s'adapter à la demande supplémentaire. En plus, leur infrastructure actuelle peut déjà encaisser un volume conséquent.</p>
<p>De l'autre côté, les jeunes services web se sont retrouvés submergés, cherchant de l'aide désespérement et des solutions pour <a href="https://en.wikipedia.org/wiki/Shard_%28database_architecture%29">sharder</a> et répliquer leur base de donnée relationnelle existante (plus à ce sujet un peu plus loin).<br />
Je prends à présent l'exemple hypothétique d'une startup EdTech offrant un service de classe en ligne innovant.</p>
<ol>
<li><strong>Volume d'usage nominal</strong> : Quelques clients aiment leur produit, &quot;c'est le futur&quot;, ils croient au potentiel de croissance et l'ajout de fonctionnalités avec le temps. Il y a donc un faible volume d'utilisation pour le moment et une croissance mesurée attendue, ils ont opté pour quelques serveurs OVH économiquement intéressants.</li>
<li><strong>Maturité du produit</strong> : Leur produit est très jeune, ils misent sur l'innovation et des boucles de feedback rapides pour l'étoffer.</li>
<li><strong>Compétences techniques</strong> : Des stagiaires, peut-être de jeunes employés, parfois des fondateurs qui font eux-mêmes les premiers prototypes. A ce niveau les salaires pèsent beaucoup dans la balance.</li>
</ol>
<p>Je m'autorise ici une conclusion préliminaire à la première question : les entreprises n'auraient pas pu anticiper, et même j'irai plus loin pour les plus petites d'entre elles, elles ne devaient pas le faire… En effet, si on souhaite créer un produit avec du scaling &quot;infini&quot; dès le début, ça implique d'investir beaucoup <strong>en temps et en argent</strong>. Deux ressources précieuses que l'on préfère rationnellement investir sur d'autres sujets quand on est un business en phase de démarrage (comme trouver sa place sur le marché, ajouter des fonctionnalités, croître, …).</p>
<blockquote>
<p><img src="/public/images/articles/2020-04-02-scaling-stories-comment-les-startups-se-sont-plantees/black-swan.jpg" alt="cygne noir" />
Covid-19 est un très bon exemple de ce qu'on appelle un évènement <a href="https://fr.wikipedia.org/wiki/Th%C3%A9orie_du_cygne_noir">&quot;cygne noir&quot;</a>
Un évènement qui est très rare, a des répercussions massives, que les entreprises n'avaient donc pas prévu.<br />
En effet ce point est assez évident, néanmoins je trouve cet &quot;interlude du cygne&quot; bienvenu 😉</p>
</blockquote>
<p>J'ai pu parler récemment avec quelques startups EdTech qui recherchaient des solutions urgemment… Elles en étaient au même point : elles ne pouvaient plus doper les ressources de leur base de donnée relationnelle (<strong>scale up</strong>). Après avoir essayé d'ajouter du cache, déployer de nouveau nœuds, de refactorer leurs applications, le point limitant final restait la base de donnée… La seule solution était donc de sharder (<strong>scale out</strong>) afin de répartir les écritures sur plusieurs instances en parallèle. Ils cherchaient donc des solutions intelligentes (dans le sens autonomes) à ajouter en amont de leur base de donnée afin de pouvoir continuer le scale. Pas si évident, et plutôt cher…
Et je ne parlerai même pas de la gestion de la <strong>migration</strong> dans ce contexte !</p>
<p>Pour avoir une idée de la difficulté de sharder une base de donnée existante, je dirais que plus le requêtage des données est global et complexe (par exemple de l'agrégation cross-compte), le plus intelligent et cher devra être le proxy en amont. Ca peut aller d'une simple hash-distribution à un &quot;query planner&quot; distribué complexe, et difficile à scale lui aussi par ailleurs.</p>
<p>A la lumière du modèle de <em>scaling maturity</em>, il est assez clair qu'on ne peut les blâmer de ne pas avoir eu ces mécanismes de scale déjà en place auparavant, mais elles auraient pu au moins avoir mieux planifié leur <strong>prochaine étape de scale</strong>.</p>
<h2>Comment on scale efficacement quand on est une startup?</h2>
<p>Déconstruisons déjà ce qui doit être &quot;scaled&quot; :</p>
<ul>
<li><strong>la capacité serveur</strong> : La maîtrise des coûts implique un dimensionnement adapté en terme de taille CPU/RAM/storage. Par serveur, j'entends noeuds physiques, virtuels ou containers.</li>
<li><strong>les patterns d'accès aux données</strong> : C'est à dire connaître son usage, éviter de gérer des états partagés, des requêtes globales, préférer l'immutabilité, …</li>
<li><strong>l'intervention humaine et la maintenance</strong> : Plus on automatise, plus vite on peut itérer, des outils comme Github, CircleCI ou terraform sont précieux.</li>
<li><strong>le refactoring de code</strong> : &quot;scale&quot; veut souvent dire pré-calculer des états, utiliser du cache, plus de synchronisation, tout ça doit être codé et maintenu également…</li>
</ul>
<p>Note : si votre produit n'a pas encore de traction réelle, se préoccuper de ce sujet est probablement prématuré et inutile, un rapide prototype MVC avec la techno que vous connaissez déjà fera tout à fait l'affaire.</p>
<p>Mais si vous avez de l'usage et une première idée de la direction du produit, alors il y a plusieurs possibilités. Si vous avez avec vous un fondateur au profil technique il sait certainement quoi faire. Sinon, et en particulier si vous avez levé des fonds, c'est une bonne idée de se faire accompagner sur le design de l'infrastructure dès à présent.</p>
<p>Explorons différentes stratégies.</p>
<h3>La stratégie de scaling infini</h3>
<p>Dissipons immédiatement les nuages de fumée, il est théoriquement possible d'<strong>approcher</strong> une telle architecture mais ce sera très coûteux (en temps et en argent – encore une fois deux choses précieuses pour une startup), et potentiellement assez rigide.<br />
La clé ici serait d'utiliser au maximum des services gérés de haut niveau qui tournent sur de grosses infrastructures clouds. Les services choisis devraient être 100% dynamiques, c'est à dire scale de manière autogérée : on ne devrait pas avoir à gérer de ressources physiques ou même virtuelles. Idéalement ces services intègreraient de base de la réplication (pour scale en lecture) et du sharding (pour scale en écriture) et pourraient être répartis dans différentes régions sur la planète.</p>
<p>Voici quelques exemples de services gérés de cet ordre :</p>
<ul>
<li>Base de donnée relationnelle : Google Cloud Spanner</li>
<li>NoSQL synchronisation temps réel : Google Firestore</li>
<li>Cluster de cache cross-region : AWS Elasticache</li>
<li>Stockage de fichier distributé : AWS S3</li>
<li>Data streaming : Google Pub/Sub</li>
<li>Data warehouse : Google BigQuery</li>
</ul>
<p>Hé oui, ça fait beaucoup de services Google, tout simplement parce qu'ils ont un train d'avance !</p>
<p><img src="/public/images/articles/2020-04-02-scaling-stories-comment-les-startups-se-sont-plantees/dynamic-scaling-curve-fr.png" alt="courbe de scaling dynamique" /></p>
<p><em>Ici je me dois de nuancer cette courbe</em></p>
<ul>
<li>Le prix est en fait très bas au démarrage : ces services offrent des niveaux d'utilisation gratuit pour un volume limité et/ou pendant une période limitée.</li>
<li>Une fois un usage conséquent atteint, un tarif dégressif ou des techniques d'optimisation des coûts liées au provider viendront réduire la facture.</li>
</ul>
<h3>La stratégie de scaling step-by-step</h3>
<p><img src="/public/images/articles/2020-04-02-scaling-stories-comment-les-startups-se-sont-plantees/static-scaling-curve-fr.png" alt="courbe de scaling step by step" /></p>
<p>C'est la stratégie classique et probablement la plus efficace, on fait avec ce qu'on a à disposition au début (compétences, personnes) mais on essaie d'avoir toujours un coup d'avance. On reste conscient des points de fragilité du système, et on sait comment y remédier. On s'attache à planifier les prochaines migrations.<br />
Ca nécessite en particulier :</p>
<ul>
<li>De développer une pipeline solide de monitoring et d'alerting. Il y a beaucoup d'outils pour faire ça aujourd'hui.</li>
<li>De tester chaque migration. Car plus le système est distribué, le moins prévisibles seront les problèmes. Il est plus simple de tester avant de migrer.</li>
</ul>
<p>Par exemple, les prochaines étapes de scale planifiées pourraient être :</p>
<ul>
<li>Sharder la base de donnée ou le stream de données.</li>
<li>Conserver les données en silos isolés logiquement, afin de pouvoir scaler plus simplement le reste.</li>
<li>Introduire un scaling automatique des services HTTP basé sur le trafic.</li>
</ul>
<p>Le principal est de rester économique et intelligent : pour scale efficacement il faut scale dans les bonnes proportions et au bon moment. Trop tôt et ça coûtera trop cher, trop tard et la qualité de service tombera… C'est pourquoi avoir un feedback pertinent (automatisé) sur l'architecture est un réel plus.</p>
<p>Les clouds proposent souvent des metrics de monitoring intégrées, par exemple si on utilise les environnements AWS Beanstalk pour des services web il est fourni automatiquement les métriques suivantes :</p>
<ul>
<li>le nombre de requêtes</li>
<li>la latence moyenne</li>
<li>l'indice de charge du serveur (load)</li>
<li>le CPU</li>
<li>le réseau entrant/sortant</li>
<li>…</li>
</ul>
<p>Il est très facile alors de les visualiser en dashboards, de configurer de l'alerting, ou même d'activer de l'auto-scaling basé sur le pourcentage de CPU utilisé… Autant d'outils que l'on peut utiliser directement pour scaler ses web services correctement. Après tout, le plus d'informations (métriques) on a à la base, le mieux on peut prendre les bonnes décisions au final.</p>
<p>Bien entendu, scaler efficacement c'est scaler de manière appropriée, à chaque situation sa réponse adaptée !</p>
<p>Pour conclure, la bonne solution se situe probablement entre les deux stratégies. Ca dépendra du budget, de la complexité technique du produit, et des compétences à disposition, …
Au moins j'espère que vous avez une meilleure idée de comment anticiper le scale !</p>
<p>Scale safe 👋</p>
</div><style data-emotion-rpcss="v01ydp">.rpcss-v01ydp{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin:20px auto;padding:20px;background-color:#fff;border-radius:10px;box-shadow:0 15px 15px -5px rgba(0,0,0,0.2);}@media (prefers-color-scheme:dark){.rpcss-v01ydp{background-color:#222;}}@media (max-width:540px){.rpcss-v01ydp{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-v01ydp"><style data-emotion-rpcss="ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion-rpcss="bb4ce3">.rpcss-bb4ce3{width:0px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-bb4ce3"></div><style data-emotion-rpcss="1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=Scaling%20stories%20-%20comment%20les%20startups%20se%20sont%20plant%C3%A9es%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Fscaling-stories-comment-les-startups-se-sont-plantees" target="_blank">Le partager sur Twitter</a></div><style data-emotion-rpcss="x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion-rpcss="gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div></div></div></div><div class="rpcss-qx7dny"><style data-emotion-rpcss="5518eg">.rpcss-5518eg{margin-top:20px;margin-bottom:20px;background-color:#E4EBEE;border-radius:10px;padding:20px;}@media (prefers-color-scheme:dark){.rpcss-5518eg{background-color:#111;}}</style><div class="rpcss-5518eg"><style data-emotion-rpcss="1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion-rpcss="1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion-rpcss="1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div><style data-emotion-rpcss="zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-qx7dny"><style data-emotion-rpcss="79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion-rpcss="1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion-rpcss="lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion-rpcss="um3i31">@media (max-width:400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion-rpcss="12cp4l7">.rpcss-12cp4l7{color:rgba(255,255,255,0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2020 Putain de code !</div><style data-emotion-rpcss="1y2rkzl">.rpcss-1y2rkzl{position:absolute;right:0;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);color:#fff;-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1y2rkzl" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"scaling-stories-comment-les-startups-se-sont-plantees","v":{"_0":{"TAG":0,"_0":{"slug":"scaling-stories-comment-les-startups-se-sont-plantees","filename":"2020-04-02-scaling-stories-comment-les-startups-se-sont-plantees","title":"Scaling stories - comment les startups se sont plantées","date":"Tue, 02 Jun 2020 00:00:00 GMT","draft":false,"meta":{"date":"2020-06-02T00:00:00.000Z","title":"Scaling stories - comment les startups se sont plantées","author":"cyppan","slug":"scaling-stories-comment-les-startups-se-sont-plantees"},"body":"<blockquote>\n<ul>\n<li>&quot;Ca ne fonctionne pas, mes enfants n'arrivent pas à se connecter à votre service !&quot;</li>\n<li>&quot;Nous sommes désolé notre équipe technique est mobilisée à 100% sur ce problème c'est une situation exceptionnelle… Nous vous tenons au courant.&quot;</li>\n</ul>\n</blockquote>\n<p>C'est le genre de tweet ou de message LinkedIn qu'on a pu voir se multiplier avec le confinement récent dû au Covid-19. En effet les services web, et en particulier les outils de communication ou les programmes du secteur de l'EdTech (education technology), ont dû faire face à un usage particulièrement intense et soutenu ces derniers temps. Il n'y en a que peu à ma connaissance qui ont été capables de maintenir une qualité de service acceptable (Slack et Zoom ont particulièrement brillé sur ce sujet). Si la plupart ont mis en place des solutions minutes comme des queues de connexion,\nd'autres encore ont été forcés de désactiver leur service pour une &quot;maintenance&quot; à durée indéterminée…</p>\n<p>Même en étant compréhensifs, face à un service planté, on a vite fait de changer. Après tout, avec le choix plus que fourni de services dont on dispose, pourquoi se priver ? Le problème c'est qu'après la crise, il est fort probable que nous ne reviendrons pas au service qu'on avait pourtant trouvé si cool au premier abord… Aïe, pour une startup c'est beaucoup de clients perdus, peut-être assez pour ne jamais retrouver de la traction. Une mort pénible donc pour un business, victime lui aussi du virus.</p>\n<p>Mais 🧐</p>\n<ul>\n<li><em>Ces entreprises n'auraient-elles pas pu mieux anticiper ?</em></li>\n<li><em>N'auraient-elles pas pu avoir une meilleure tech à la base, crise ou pas crise ?</em></li>\n<li><em>Et une fois devant le problème, n'auraient-elles pas pu mieux s'adapter et plus rapidement ?</em></li>\n</ul>\n<h2>le modèle de &quot;scaling maturity&quot;</h2>\n<p><img src=\"/public/images/articles/2020-04-02-scaling-stories-comment-les-startups-se-sont-plantees/scaling-maturity-fr.png\" alt=\"modèle de scaling maturity\" /></p>\n<p>En premier lieu j'aimerais introduire le concept de <em>scaling maturity</em>. &quot;To scale&quot; c'est l'art d'adapter (automatiquement ou non) sa stack technique afin de répondre à la demande en entrée. Et reconnaissons déjà que Zoom et Slack sont beaucoup plus matures que (par exemple) de jeunes startups de l'EdTech.<br />\nAnalysons les à l'aide du modèle de <em>scaling maturity</em>.</p>\n<ol>\n<li><strong>Volume d'usage nominal</strong> : Slack ou Zoom avaient déjà un trafic (très) important, le pic d'activité représente un pourcentage plus petit que pour une startup pour qui c'est peut-être un boost de 100 ou 1000 fois l'activité habituelle.</li>\n<li><strong>Maturité du produit</strong> : Ils ont eu le temps de connaître les spécificités de leur usage, les caractéristiques d'accès aux données, les points de fragilité de leur système, …</li>\n<li><strong>Compétences techniques</strong> : Ils ont probablement une équipe tech plus grande et plus expérimentée.</li>\n</ol>\n<p>Pour synthétiser, ils en savent beaucoup sur la façon dont leur produit est utilisé et quelle est leur roadmap, et donc savent bien quel type d'effort concentrer pour s'adapter à la demande supplémentaire. En plus, leur infrastructure actuelle peut déjà encaisser un volume conséquent.</p>\n<p>De l'autre côté, les jeunes services web se sont retrouvés submergés, cherchant de l'aide désespérement et des solutions pour <a href=\"https://en.wikipedia.org/wiki/Shard_%28database_architecture%29\">sharder</a> et répliquer leur base de donnée relationnelle existante (plus à ce sujet un peu plus loin).<br />\nJe prends à présent l'exemple hypothétique d'une startup EdTech offrant un service de classe en ligne innovant.</p>\n<ol>\n<li><strong>Volume d'usage nominal</strong> : Quelques clients aiment leur produit, &quot;c'est le futur&quot;, ils croient au potentiel de croissance et l'ajout de fonctionnalités avec le temps. Il y a donc un faible volume d'utilisation pour le moment et une croissance mesurée attendue, ils ont opté pour quelques serveurs OVH économiquement intéressants.</li>\n<li><strong>Maturité du produit</strong> : Leur produit est très jeune, ils misent sur l'innovation et des boucles de feedback rapides pour l'étoffer.</li>\n<li><strong>Compétences techniques</strong> : Des stagiaires, peut-être de jeunes employés, parfois des fondateurs qui font eux-mêmes les premiers prototypes. A ce niveau les salaires pèsent beaucoup dans la balance.</li>\n</ol>\n<p>Je m'autorise ici une conclusion préliminaire à la première question : les entreprises n'auraient pas pu anticiper, et même j'irai plus loin pour les plus petites d'entre elles, elles ne devaient pas le faire… En effet, si on souhaite créer un produit avec du scaling &quot;infini&quot; dès le début, ça implique d'investir beaucoup <strong>en temps et en argent</strong>. Deux ressources précieuses que l'on préfère rationnellement investir sur d'autres sujets quand on est un business en phase de démarrage (comme trouver sa place sur le marché, ajouter des fonctionnalités, croître, …).</p>\n<blockquote>\n<p><img src=\"/public/images/articles/2020-04-02-scaling-stories-comment-les-startups-se-sont-plantees/black-swan.jpg\" alt=\"cygne noir\" />\nCovid-19 est un très bon exemple de ce qu'on appelle un évènement <a href=\"https://fr.wikipedia.org/wiki/Th%C3%A9orie_du_cygne_noir\">&quot;cygne noir&quot;</a>\nUn évènement qui est très rare, a des répercussions massives, que les entreprises n'avaient donc pas prévu.<br />\nEn effet ce point est assez évident, néanmoins je trouve cet &quot;interlude du cygne&quot; bienvenu 😉</p>\n</blockquote>\n<p>J'ai pu parler récemment avec quelques startups EdTech qui recherchaient des solutions urgemment… Elles en étaient au même point : elles ne pouvaient plus doper les ressources de leur base de donnée relationnelle (<strong>scale up</strong>). Après avoir essayé d'ajouter du cache, déployer de nouveau nœuds, de refactorer leurs applications, le point limitant final restait la base de donnée… La seule solution était donc de sharder (<strong>scale out</strong>) afin de répartir les écritures sur plusieurs instances en parallèle. Ils cherchaient donc des solutions intelligentes (dans le sens autonomes) à ajouter en amont de leur base de donnée afin de pouvoir continuer le scale. Pas si évident, et plutôt cher…\nEt je ne parlerai même pas de la gestion de la <strong>migration</strong> dans ce contexte !</p>\n<p>Pour avoir une idée de la difficulté de sharder une base de donnée existante, je dirais que plus le requêtage des données est global et complexe (par exemple de l'agrégation cross-compte), le plus intelligent et cher devra être le proxy en amont. Ca peut aller d'une simple hash-distribution à un &quot;query planner&quot; distribué complexe, et difficile à scale lui aussi par ailleurs.</p>\n<p>A la lumière du modèle de <em>scaling maturity</em>, il est assez clair qu'on ne peut les blâmer de ne pas avoir eu ces mécanismes de scale déjà en place auparavant, mais elles auraient pu au moins avoir mieux planifié leur <strong>prochaine étape de scale</strong>.</p>\n<h2>Comment on scale efficacement quand on est une startup?</h2>\n<p>Déconstruisons déjà ce qui doit être &quot;scaled&quot; :</p>\n<ul>\n<li><strong>la capacité serveur</strong> : La maîtrise des coûts implique un dimensionnement adapté en terme de taille CPU/RAM/storage. Par serveur, j'entends noeuds physiques, virtuels ou containers.</li>\n<li><strong>les patterns d'accès aux données</strong> : C'est à dire connaître son usage, éviter de gérer des états partagés, des requêtes globales, préférer l'immutabilité, …</li>\n<li><strong>l'intervention humaine et la maintenance</strong> : Plus on automatise, plus vite on peut itérer, des outils comme Github, CircleCI ou terraform sont précieux.</li>\n<li><strong>le refactoring de code</strong> : &quot;scale&quot; veut souvent dire pré-calculer des états, utiliser du cache, plus de synchronisation, tout ça doit être codé et maintenu également…</li>\n</ul>\n<p>Note : si votre produit n'a pas encore de traction réelle, se préoccuper de ce sujet est probablement prématuré et inutile, un rapide prototype MVC avec la techno que vous connaissez déjà fera tout à fait l'affaire.</p>\n<p>Mais si vous avez de l'usage et une première idée de la direction du produit, alors il y a plusieurs possibilités. Si vous avez avec vous un fondateur au profil technique il sait certainement quoi faire. Sinon, et en particulier si vous avez levé des fonds, c'est une bonne idée de se faire accompagner sur le design de l'infrastructure dès à présent.</p>\n<p>Explorons différentes stratégies.</p>\n<h3>La stratégie de scaling infini</h3>\n<p>Dissipons immédiatement les nuages de fumée, il est théoriquement possible d'<strong>approcher</strong> une telle architecture mais ce sera très coûteux (en temps et en argent – encore une fois deux choses précieuses pour une startup), et potentiellement assez rigide.<br />\nLa clé ici serait d'utiliser au maximum des services gérés de haut niveau qui tournent sur de grosses infrastructures clouds. Les services choisis devraient être 100% dynamiques, c'est à dire scale de manière autogérée : on ne devrait pas avoir à gérer de ressources physiques ou même virtuelles. Idéalement ces services intègreraient de base de la réplication (pour scale en lecture) et du sharding (pour scale en écriture) et pourraient être répartis dans différentes régions sur la planète.</p>\n<p>Voici quelques exemples de services gérés de cet ordre :</p>\n<ul>\n<li>Base de donnée relationnelle : Google Cloud Spanner</li>\n<li>NoSQL synchronisation temps réel : Google Firestore</li>\n<li>Cluster de cache cross-region : AWS Elasticache</li>\n<li>Stockage de fichier distributé : AWS S3</li>\n<li>Data streaming : Google Pub/Sub</li>\n<li>Data warehouse : Google BigQuery</li>\n</ul>\n<p>Hé oui, ça fait beaucoup de services Google, tout simplement parce qu'ils ont un train d'avance !</p>\n<p><img src=\"/public/images/articles/2020-04-02-scaling-stories-comment-les-startups-se-sont-plantees/dynamic-scaling-curve-fr.png\" alt=\"courbe de scaling dynamique\" /></p>\n<p><em>Ici je me dois de nuancer cette courbe</em></p>\n<ul>\n<li>Le prix est en fait très bas au démarrage : ces services offrent des niveaux d'utilisation gratuit pour un volume limité et/ou pendant une période limitée.</li>\n<li>Une fois un usage conséquent atteint, un tarif dégressif ou des techniques d'optimisation des coûts liées au provider viendront réduire la facture.</li>\n</ul>\n<h3>La stratégie de scaling step-by-step</h3>\n<p><img src=\"/public/images/articles/2020-04-02-scaling-stories-comment-les-startups-se-sont-plantees/static-scaling-curve-fr.png\" alt=\"courbe de scaling step by step\" /></p>\n<p>C'est la stratégie classique et probablement la plus efficace, on fait avec ce qu'on a à disposition au début (compétences, personnes) mais on essaie d'avoir toujours un coup d'avance. On reste conscient des points de fragilité du système, et on sait comment y remédier. On s'attache à planifier les prochaines migrations.<br />\nCa nécessite en particulier :</p>\n<ul>\n<li>De développer une pipeline solide de monitoring et d'alerting. Il y a beaucoup d'outils pour faire ça aujourd'hui.</li>\n<li>De tester chaque migration. Car plus le système est distribué, le moins prévisibles seront les problèmes. Il est plus simple de tester avant de migrer.</li>\n</ul>\n<p>Par exemple, les prochaines étapes de scale planifiées pourraient être :</p>\n<ul>\n<li>Sharder la base de donnée ou le stream de données.</li>\n<li>Conserver les données en silos isolés logiquement, afin de pouvoir scaler plus simplement le reste.</li>\n<li>Introduire un scaling automatique des services HTTP basé sur le trafic.</li>\n</ul>\n<p>Le principal est de rester économique et intelligent : pour scale efficacement il faut scale dans les bonnes proportions et au bon moment. Trop tôt et ça coûtera trop cher, trop tard et la qualité de service tombera… C'est pourquoi avoir un feedback pertinent (automatisé) sur l'architecture est un réel plus.</p>\n<p>Les clouds proposent souvent des metrics de monitoring intégrées, par exemple si on utilise les environnements AWS Beanstalk pour des services web il est fourni automatiquement les métriques suivantes :</p>\n<ul>\n<li>le nombre de requêtes</li>\n<li>la latence moyenne</li>\n<li>l'indice de charge du serveur (load)</li>\n<li>le CPU</li>\n<li>le réseau entrant/sortant</li>\n<li>…</li>\n</ul>\n<p>Il est très facile alors de les visualiser en dashboards, de configurer de l'alerting, ou même d'activer de l'auto-scaling basé sur le pourcentage de CPU utilisé… Autant d'outils que l'on peut utiliser directement pour scaler ses web services correctement. Après tout, le plus d'informations (métriques) on a à la base, le mieux on peut prendre les bonnes décisions au final.</p>\n<p>Bien entendu, scaler efficacement c'est scaler de manière appropriée, à chaque situation sa réponse adaptée !</p>\n<p>Pour conclure, la bonne solution se situe probablement entre les deux stratégies. Ca dépendra du budget, de la complexité technique du produit, et des compétences à disposition, …\nAu moins j'espère que vous avez une meilleure idée de comment anticiper le scale !</p>\n<p>Scale safe 👋</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><script defer="defer" src="/public/main.2599a1d86828331ee2e0.js"></script></html>